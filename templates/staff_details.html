{% extends "base.html" %}
{% block content %}

<div class="p-8">
  <h1 class="text-4xl font-bold text-center text-primary mb-8">Staff Details</h1>

  <!-- Search Bar -->
  <div class="flex justify-center mb-6">
    <form method="GET" action="/staff/details" class="w-full max-w-lg">
      <div class="join w-full">
        <input type="text" name="search"
               placeholder="Search staff by name, department, or ID"
               value="{{ request.args.get('search', '') }}"
               class="input input-bordered join-item w-full" />
        <button type="submit" class="btn btn-primary join-item">Search</button>
      </div>
    </form>
  </div>

  <!-- Staff Table -->
  <div class="overflow-x-auto">
    <table class="table table-zebra w-full border border-base-300 shadow-md rounded-lg text-sm">
      <thead class="bg-base-200 text-primary">
        <tr>
          <th>Staff ID</th>
          <th>Name</th>
          <th>Department</th>
          <th>Designation</th>
          <th>Date of Joining</th>
          <th>Base Salary</th>
          <th>Bank Account</th>
          <th>Aadhar</th>
          <th>PF No</th>
          <th>ESI No</th>
          <th>Status</th>
          {% if current_user.is_admin %}
          <th>Actions</th>
          {% endif %}
        </tr>
      </thead>

      <tbody>
        {% if staff_list %}
          {% for staff in staff_list %}
          <tr>
            <td class="font-semibold">{{ staff.staff_id }}</td>
            <td>{{ staff.name }}</td>
            <td>{{ staff.department }}</td>
            <td>{{ staff.designation }}</td>
            <td>{{ staff.date_joined.strftime('%d-%m-%Y') if staff.date_joined else '-' }}</td>
            <td>â‚¹{{ "{:,.2f}".format(staff.base_salary) }}</td>
            <td>{{ staff.bank_account }}</td>
            <td>{{ staff.aadhar }}</td>
            <td>{{ staff.pf_number or '-' }}</td>
            <td>{{ staff.esi_number or '-' }}</td>
            <td>
              {% if staff.active %}
              <span class="badge badge-success">Active</span>
              {% else %}
              <span class="badge badge-ghost">Inactive</span>
              {% endif %}
            </td>
            {% if current_user.is_admin %}
            <td class="whitespace-nowrap">
              <a href="/staff/edit/{{ staff.id }}" class="btn btn-sm btn-outline btn-info mx-1">Edit</a>
              <a href="/staff/delete/{{ staff.id }}" class="btn btn-sm btn-outline btn-error mx-1"
                 onclick="return confirm('Are you sure you want to delete this staff record?');">Delete</a>
            </td>
            {% endif %}
          </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td colspan="12" class="text-center py-6 text-gray-500">
              No staff records found.
            </td>
          </tr>
        {% endif %}
      </tbody>
    </table>
  </div>

  {% if current_user.is_admin %}
  <div class="flex justify-end mt-6">
    <a href="/staff/new" class="btn btn-primary">Add New Staff</a>
  </div>
  {% endif %}
</div>

{% endblock %}
