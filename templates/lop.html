{% extends "base.html" %}
{% block content %}

<div class="p-8 space-y-10">
  <h1 class="text-4xl font-bold text-center text-primary mb-8">
    Loss of Pay (LOP) Entry
  </h1>

  <form method="POST" action="/lop">
    <!-- Select Month -->
    <section class="card bg-base-100 shadow-xl border border-base-300 p-6 rounded-2xl space-y-6">
      <div class="flex flex-col md:flex-row items-center justify-between gap-4">
        <h2 class="text-2xl font-semibold text-secondary">Select Month & Year</h2>
        <input type="month" name="lop_month" id="lopMonth"
               value="{{ selected_month or current_year ~ '-' ~ '%02d'|format(current_month) }}"
               class="input input-bordered w-60" required>
      </div>
    </section>

    <section class="card bg-base-100 shadow-xl border border-base-300 p-8 rounded-2xl space-y-6">
      <h2 class="text-2xl font-semibold text-secondary mb-6">Enter LOP Days for Staff</h2>

      {% if staff_list %}
      <div class="overflow-x-auto">
        <table class="table table-zebra w-full text-center">
          <thead>
            <tr class="bg-base-200 text-sm">
              <th>#</th>
              <th>Staff ID</th>
              <th>Name</th>
              <th>LOP Days</th>
            </tr>
          </thead>
          <tbody>
            {% for s in staff_list %}
            {% set r = s.salary_records|selectattr('month', 'equalto', selected_month_int)|selectattr('year', 'equalto', selected_year)|first %}
            <tr>
              <td>{{ loop.index }}</td>
              <td>{{ s.staff_id }}</td>
              <td>{{ s.name }}</td>
              <td>
                <input type="number" step="0.5" min="0" name="lop_{{ s.id }}"
                       class="input input-bordered w-24 text-center"
                       value="{{ r.lop_days if r else 0 }}">
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
        <p class="text-center text-gray-500 mt-6">No staff found.</p>
      {% endif %}
    </section>

    <!-- Save Button -->
    <div class="flex justify-end mt-10">
      <button type="submit" class="btn btn-primary text-lg">ðŸ’¾ Save LOP Days</button>
    </div>
  </form>
</div>

{% endblock %}
